<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Kurs Reacta - Tydzień 3/zadanie 8</title>
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- biblioteka uuid do generowania unikalnycj id -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/node-uuid/1.4.8/uuid.min.js"></script>
  <style>
    .App {
      font-family: sans-serif;
    }

    .Timebox {
      border: 1px solid gray;
      border-radius: 5px;
      padding: 5px;
      margin-bottom: 10px;
    }

    .TimeboxEditor,
    .TimeboxCreator {
      text-align: right;
      border: 1px solid gray;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
    }

    input {
      min-width: 60%;
      margin-left: 20px;
      font-size: 16px;
    }

    button {
      font-size: 16px;
      margin-left: 10px;
    }
  </style>
</head>

<body>
  <h1>
    Kurs Reacta - Tydzień 3 - zadanie 8 - dodanie obsługi edycji i dodawania
  </h1>
  <hr />

  <div id="root"></div>
</body>
<script type="text/babel">
  class TimeboxCreator extends React.Component {
      state = {
        title: "",
        totalTimeInMinutes: ""
      };
      handleInputChange = e => {
        this.setState({
          [e.target.name]: e.target.value
        });
      };
      
      add = () => {
        const { onCreate } = this.props;
        const { title, totalTimeInMinutes } = this.state;
        if (title.length < 3 || totalTimeInMinutes <= 0) return;
        onCreate({
          id: uuid.v4(),
          title,
          totalTimeInMinutes
        });
        this.setState({
          title: "",
          totalTimeInMinutes: ""
        });
      };
      render() {
        const { title, totalTimeInMinutes } = this.state;
        const {
          onCreate,
          onTitleChange,
          onTotalTimeInMinutesChange
        } = this.props;

        return (
          <div className="TimeboxCreator">
            <label>
              Co robisz?
              <input value={title} type="text" onChange={this.handleInputChange} name="title" />
            </label>
            <br />
            <label>
              Ile minut?
              <input
                value={totalTimeInMinutes}
                type="number"
                onChange={this.handleInputChange}
                name="totalTimeInMinutes"
              />
            </label>
            <br />
            <button onClick={this.add}>dodaj timebox</button>
          </div>
        );
      }
    }

    class EditTimebox extends React.Component {
      state = {
        title: this.props.title,
        totalTimeInMinutes: this.props.totalTimeInMinutes
      }
      handleInput = e=>{
        this.setState({
          [e.target.name]: e.target.value
        })
      }
      update=()=>{
        const {id, onUpdate} = this.props;
        const {title, totalTimeInMinutes} = this.state;
        if(title.length < 3 || totalTimeInMinutes <= 0) return;
        onUpdate(id,{id,title,totalTimeInMinutes});
      }
      render(){
        const {title, totalTimeInMinutes} = this.state;
        const { cancelEdit } = this.props;
        return(
          <div  className="TimeboxEditor">
            <label>title:</label>
            <input type="text" value={title} name="title" onChange={this.handleInput} /><br/>
            <label>time:</label>
            <input
              type="number"
              value={totalTimeInMinutes}
              name="totalTimeInMinutes" onChange={this.handleInput}
            /><br/>
            <button type="submit" onClick={this.update}>update</button>
            <button onClick={cancelEdit}>cancel</button>
          </div>
        )
      }
    } 

    const Timebox = ({
      title,
      totalTimeInMinutes,
      onDelete,
      onEdit,
      isEditable
    }) => (
      <>
        <div className="Timebox">
          <h3>
            {title} - {totalTimeInMinutes} min.
          </h3>

          {isEditable || (
            <>
              <button onClick={onDelete}>usuń</button>
              <button onClick={onEdit}>edycja</button>
            </>
          )}
        </div>
      </>
    );

    class TimeboxList extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          isEditable: false,
          timeboxes: [
            {
              id: "a",
              title: "uczę sie reacta",
              totalTimeInMinutes: 10
            },
            {
              id: "b",
              title: "uczę sie laravela",
              totalTimeInMinutes: 23
            },
            {
              id: "c",
              title: "uczę sie js es6",
              totalTimeInMinutes: 22
            }
          ]
        };
      }

      handleCreate = (createdTimebox) => {
        this.setState(prevState => ({
          timeboxes: [createdTimebox, ...prevState.timeboxes] // dodajemy element na początku tablicy
        }));
      };

      handleDelete = id => {
        const index = this.state.timeboxes.findIndex(timebox => timebox.id === id);
        let timeboxes = this.state.timeboxes.splice(index, 1);
        this.setState(prevState => ({
          timeboxes: prevState.timeboxes
        }))
      };

      handleEditTimebox= (id, title, totalTimeInMinutes, isEditable) =>{
        this.setState({
          id,
          title,
          totalTimeInMinutes,
          isEditable: true
        });
      }

      cancelEdit = () => {
        this.setState({
          isEditable: false
        });
      };

      handleUpdateTimebox = (id, updatedTimebox) => {
        this.setState({
          timeboxes: this.state.timeboxes.map(timebox => timebox.id === id ? updatedTimebox : timebox ),
          isEditable: false
        });
      };

      render() {
        const { isEditable,id, title, totalTimeInMinutes } = this.state;
        return (
          <>
            {isEditable ? (
              <EditTimebox
                id={id}
                title={title}
                totalTimeInMinutes={totalTimeInMinutes}
                onUpdate={this.handleUpdateTimebox}
                cancelEdit={this.cancelEdit}
              />
            ) : (
              <>
                <TimeboxCreator onCreate={this.handleCreate} />
                {this.state.timeboxes.map(
                  ({ id, title, totalTimeInMinutes }) => (
                    <Timebox
                      key={id}
                      title={title}
                      isEditable={isEditable}
                      totalTimeInMinutes={totalTimeInMinutes}
                      onDelete={() => this.handleDelete(id)}
                      onEdit={() =>
                        this.handleEditTimebox(id, title, totalTimeInMinutes)
                      }
                    />
                  )
                )}
              </>
            )}
          </>
        );
      }
    }

    class App extends React.Component {
      render() {
        return (
          <div className="App">
            <TimeboxList />
          </div>
        );
      }
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>

</html>