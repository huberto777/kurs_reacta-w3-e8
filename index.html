<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Kurs Reacta - Tydzień 3/zadanie 8</title>
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- biblioteka uuid do generowania unikalnycj id -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/node-uuid/1.4.8/uuid.min.js"></script>
  <style>
    .App {
      font-family: sans-serif;
    }

    .Timebox {
      border: 1px solid gray;
      border-radius: 5px;
      padding: 5px;
      margin-bottom: 10px;
    }

    .TimeboxEditor,
    .TimeboxCreator {
      text-align: right;
      border: 1px solid gray;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
    }

    input {
      min-width: 60%;
      margin-left: 20px;
      font-size: 16px;
    }

    button {
      font-size: 16px;
      margin-left: 10px;
    }
  </style>
</head>

<body>
  <h1>
    Kurs Reacta - Tydzień 3 - zadanie 8 - dodanie obsługi edycji (z użyciem arguments) i dodawania
  </h1>
  <hr />

  <div id="root"></div>
</body>
<script type="text/babel">
  class TimeboxCreator extends React.Component {
      state = {
        title: "",
        totalTimeInMinutes: ""
      };
      onTitleChange = e => {
        this.setState({
          title: e.target.value
        });
        // console.log(e.target.value);
      };
      onTotalTimeInMinutesChange = e => {
        this.setState({
          totalTimeInMinutes: e.target.value
        });
      };
      add = () => {
        const { onCreate } = this.props;
        const { title, totalTimeInMinutes } = this.state;
        if (title.length < 3 || !totalTimeInMinutes) return;
        onCreate({
          id: uuid.v4(),
          title,
          totalTimeInMinutes
        });
        this.setState({
          title: "",
          totalTimeInMinutes: ""
        });
      };
      render() {
        const { title, totalTimeInMinutes } = this.state;
        const {
          onCreate,
          onTitleChange,
          onTotalTimeInMinutesChange
        } = this.props;

        return (
          <div className="TimeboxCreator">
            <label>
              Co robisz?
              <input value={title} type="text" onChange={this.onTitleChange} />
            </label>
            <br />
            <label>
              Ile minut?
              <input
                value={totalTimeInMinutes}
                type="number"
                onChange={this.onTotalTimeInMinutesChange}
              />
            </label>
            <br />
            <button onClick={this.add}>dodaj timebox</button>
          </div>
        );
      }
    }

    const EditTimebox = ({
      title,
      totalTimeInMinutes,
      onUpdate,
      cancelEdit
    }) => {
      // console.log(onUpdate);
      return (
        <form onSubmit={onUpdate} className="TimeboxEditor">
          <label>title:</label>
          <input type="text" defaultValue={title} name="updateTitle" /><br/>
          <label>time:</label>
          <input
            type="number"
            defaultValue={totalTimeInMinutes}
            name="updateTotalTimeInMinutes"
          /><br/>
          <button type="submit">update</button>
          <button onClick={cancelEdit}>cancel</button>
        </form>
      );
    };

    const Timebox = ({
      title,
      totalTimeInMinutes,
      onDelete,
      onEdit,
      isEditable
    }) => (
      <>
        <div className="Timebox">
          <h3>
            {title} - {totalTimeInMinutes} min.
          </h3>

          {isEditable || (
            <>
              <button onClick={onDelete}>usuń</button>
              <button onClick={onEdit}>edycja</button>
            </>
          )}
        </div>
      </>
    );

    class TimeboxList extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          isEditable: false,
          timeboxes: [
            {
              id: "a",
              title: "uczę sie reacta",
              totalTimeInMinutes: 10
            },
            {
              id: "b",
              title: "uczę sie laravela",
              totalTimeInMinutes: 23
            },
            {
              id: "c",
              title: "uczę sie js es6",
              totalTimeInMinutes: 22
            }
          ]
        };
        this.handleEditTimebox = this.handleEditTimebox.bind(this);
      }

      handleCreate = (createdTimebox) => {
        this.setState(prevState => ({
          timeboxes: [createdTimebox, ...prevState.timeboxes] // dodajemy element na początku tablicy
        }));
      };

      handleDelete = id => {
        const index = this.state.timeboxes.findIndex(timebox => timebox.id === id);
        let timeboxes = this.state.timeboxes.splice(index, 1);
        this.setState(prevState => ({
          timeboxes: prevState.timeboxes
        }))
      };

      handleEditTimebox() {
        // console.log(arguments);
        this.setState({
          id: arguments[0],
          title: arguments[1],
          totalTimeInMinutes: arguments[2],
          isEditable: !this.state.isEditable
        });
      }

      cancelEdit = () => {
        this.setState({
          isEditable: !this.state.isEditable
        });
      };

      handleUpdateTimebox = e => {
        e.preventDefault();
        this.setState({
          timeboxes: this.state.timeboxes.map(timebox => {
            if (timebox.id === this.state.id) {
              timebox.title = e.target.updateTitle.value;
              timebox.totalTimeInMinutes =
                e.target.updateTotalTimeInMinutes.value;
            }
            return timebox;
          }),
          isEditable: false
        });
      };

      render() {
        const { isEditable, title, totalTimeInMinutes } = this.state;
        return (
          <>
            {isEditable ? (
              <EditTimebox
                title={title}
                totalTimeInMinutes={totalTimeInMinutes}
                onUpdate={this.handleUpdateTimebox}
                cancelEdit={this.cancelEdit}
              />
            ) : (
              <>
                <TimeboxCreator onCreate={this.handleCreate} />
                {this.state.timeboxes.map(
                  ({ id, title, totalTimeInMinutes }) => (
                    <Timebox
                      key={id}
                      title={title}
                      isEditable={isEditable}
                      totalTimeInMinutes={totalTimeInMinutes}
                      onDelete={() => this.handleDelete(id)}
                      onEdit={() =>
                        this.handleEditTimebox(id, title, totalTimeInMinutes)
                      }
                    />
                  )
                )}{" "}
              </>
            )}
          </>
        );
      }
    }

    class App extends React.Component {
      render() {
        return (
          <div className="App">
            <TimeboxList />
          </div>
        );
      }
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>

</html>